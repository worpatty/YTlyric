var e={};e.video=null;e.onTickFlag=null;e.intervalFuncId=null;e.loopFlag=true;var t={};t.currentSubtitleElem=null;t.currentStartTime=null;t.currentEndTime=null;t.lastUserScrollTime=null;t.isScrollLock=false;function a(){var e=document.createElement("script");e.src="https://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function onYouTubePlayerAPIReady(){n(g_videoId)}function n(t){e.video=new YT.Player("main_video_player",{videoId:t,playerVars:{playsinline:"1"},events:{onReady:l,onStateChange:r}})}function l(e){$(".fantube-movie__loading-bg").hide()}function r(a){if(a.data===YT.PlayerState.PLAYING){$(".fantube-footer__player-col.play-btn").addClass("pause-btn");o()}if(a.data===YT.PlayerState.PAUSED){$(".fantube-footer__player-col.play-btn").removeClass("pause-btn");b()}if(a.data===YT.PlayerState.ENDED){$(".fantube-footer__player-col.play-btn").removeClass("pause-btn");if(e.loopFlag){e.video.seekTo(0);return}if(t.currentSubtitleElem!==null||t.currentSubtitleElem!==undefined){if(t.currentSubtitleElem.find(".fantube-movie__subtitle-repeat-btn").hasClass("active")){e.video.seekTo(t.currentStartTime);return}}b()}}function s(e){function t(e){var t=Math.floor(e/60);var a=e-t*60;return t+" : "+a}var a=$(".fantube-movie-subtitle-box");a.empty();var i=e.subLanguage;var n=$("#subtitle_elem_template");n.attr("id","");for(var l=0;l<e.contents.length;++l){var r=n.clone();var s=e.contents[l];r.css("display","table").attr("data-start-time",s.start).attr("data-end-time",s.end).attr("data-sub-idx",l);r.find(".fantube-movie__subtitle-main").html(s.subtitles.main);r.find(".fantube-movie__subtitle-sub").html(s.subtitles.sub01);a.append(r)}u($('.fantube-movie__subtitle[data-sub-idx="0"]'))}function o(){if(e.onTickFlag===true){return}if(e.video===null){return}e.onTickFlag=true;e.intervalFuncId=setInterval(a,1e3);function a(){var a=Math.round(e.video.getCurrentTime());while(a<t.currentStartTime){var i=t.currentSubtitleElem.prev();if(i.length===1){u(i)}else{break}}while(a>t.currentEndTime){if(t.currentSubtitleElem.find(".fantube-movie__subtitle-repeat-btn").hasClass("active")){e.video.seekTo(t.currentStartTime);break}var n=t.currentSubtitleElem.next();if(n.length===1){u(n)}else{break}}$(".fantube-movie__subtitle").removeClass("active");t.currentSubtitleElem.addClass("active");if(t.isScrollLock===false){c(t.currentSubtitleElem)}else{var l=Date.now();if(l-t.lastUserScrollTime>3e3){t.isScrollLock=false;c(t.currentSubtitleElem)}}}}function u(e){t.currentSubtitleElem=e;t.currentStartTime=t.currentSubtitleElem.attr("data-start-time");t.currentEndTime=t.currentSubtitleElem.attr("data-end-time")}function b(){clearInterval(e.intervalFuncId);e.onTickFlag=false}function c(e){var t=$(".fantube-movie-subtitle-box");var a=e.offset().top-t.offset().top+t.scrollTop();t.animate({scrollTop:a},500,function(){})}function f(t){if(e.video.getPlayerState()!==YT.PlayerState.PLAYING&&e.video.getPlayerState()!==YT.PlayerState.PAUSE){e.video.playVideo();setTimeout(function(){e.video.seekTo(t)},800)}else{e.video.seekTo(t)}}a();$(document).ready(function(){s(subtitleContents);$(".fantube-movie-subtitle-box").on("scroll.userScroll",function(e){t.isScrollLock=true;t.lastUserScrollTime=Date.now()});$(".fantube-movie-subtitle-box").on("click",".fantube-movie__subtitle-contents",function(e){var t=$(this).closest(".fantube-movie__subtitle");var a=t.attr("data-start-time");$(".fantube-movie__subtitle").removeClass("active");t.addClass("active");$(".fantube-movie__subtitle-repeat-btn").removeClass("active");u(t);c(t);f(a)});$(".fantube-movie-subtitle-box").on("click",".fantube-movie__subtitle-repeat-btn",function(e){if($(this).hasClass("active")){$(this).removeClass("active");return}var t=$(this).closest(".fantube-movie__subtitle");var a=t.attr("data-start-time");$(".fantube-footer__player-col.repeat-btn").removeClass("active");$(".fantube-movie__subtitle-repeat-btn").removeClass("active");$(this).addClass("active");$(".fantube-movie__subtitle").removeClass("active");t.addClass("active");u(t);c(t);f(a)});$("#subtitle_select_btn").click(function(e){$(".fantube-footer__subtitle-list").toggle()});$(".fantube-footer__subtitle-list").on("click",".fantube-footer__subtitle-list__row",function(e){function a(e){for(var t in subtitleContents.contents){var a=subtitleContents.contents[t];e.find(".fantube-movie__subtitle-main").html(a.subtitles.main);e.find(".fantube-movie__subtitle-sub").empty();e=e.next();if(e.length===0){break}}}function i(e,t){for(var a in subtitleContents.contents){var i=subtitleContents.contents[a];e.find(".fantube-movie__subtitle-main").html(i.subtitles.main);e.find(".fantube-movie__subtitle-sub").html(i.subtitles[t]);e=e.next();if(e.length===0){break}}}function n(e,t){for(var a in subtitleContents.contents){var i=subtitleContents.contents[a];e.find(".fantube-movie__subtitle-main").html(i.subtitles[t]);e.find(".fantube-movie__subtitle-sub").empty();e=e.next();if(e.length===0){break}}}$(".fantube-footer__subtitle-list").hide();var l=$(this).text();var r=$(this).attr("data-main-lang");var s=$(this).attr("data-subtitle-key");var o=$(".fantube-movie__subtitle[data-sub-idx=0]");if(r==="2"){a(o)}else if(r==="1"){i(o,s)}else{n(o,s)}$("#subtitle_select_btn").text(l);c(t.currentSubtitleElem)});$(".fantube-footer__player-col.prev-btn").click(function(a){var i=t.currentSubtitleElem.prev();if(i.length===1){u(i)}$(".fantube-movie__subtitle").removeClass("active");t.currentSubtitleElem.addClass("active");if(e.video.getPlayerState()!==YT.PlayerState.PLAYING&&e.video.getPlayerState()!==YT.PlayerState.PAUSE){e.video.playVideo();setTimeout(function(){e.video.seekTo(t.currentStartTime)},1e3)}else{e.video.seekTo(t.currentStartTime)}});$(".fantube-footer__player-col.play-btn").click(function(t){if($(this).hasClass("pause-btn")){$(this).removeClass("pause-btn");e.video.pauseVideo()}else{$(this).addClass("pause-btn");e.video.playVideo()}});$(".fantube-footer__player-col.next-btn").click(function(a){var i=t.currentSubtitleElem.next();if(i.length===1){u(i)}$(".fantube-movie__subtitle").removeClass("active");t.currentSubtitleElem.addClass("active");if(e.video.getPlayerState()!==YT.PlayerState.PLAYING&&e.video.getPlayerState()!==YT.PlayerState.PAUSE){e.video.playVideo();setTimeout(function(){e.video.seekTo(t.currentStartTime)},1e3)}else{e.video.seekTo(t.currentStartTime)}});$(".fantube-footer__player-col.repeat-btn").click(function(t){if($(this).hasClass("active")){$(this).removeClass("active");e.loopFlag=false}else{$(this).addClass("active");e.loopFlag=true;$(".fantube-movie__subtitle-repeat-btn").removeClass("active")}})});
